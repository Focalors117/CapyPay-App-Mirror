<div
  id="toast-container"
  class="fixed top-4 right-4 z-99999 flex flex-col gap-2 pointer-events-none"
>
  <!-- Toasts injected here -->
</div>

<template id="toast-template">
  <div
    class="pointer-events-auto min-w-75 bg-[#1a1a1a] border border-white/10 rounded-xl p-4 shadow-2xl flex items-start gap-3 transform transition-all duration-300 translate-x-10 opacity-0"
  >
    <!-- Icon -->
    <div class="shrink-0 pt-0.5">
      <div
        class="w-5 h-5 rounded-full flex items-center justify-center icon-container"
      >
        <!-- Icon SVG -->
      </div>
    </div>
    <!-- Content -->
    <div class="flex-1">
      <h4 class="text-sm font-bold text-white title">Notificación</h4>
      <p class="text-xs text-slate-400 mt-0.5 message">Mensaje aquí</p>
    </div>
    <!-- Close -->
    <button
      class="text-slate-500 hover:text-white transition-colors shrink-0 close-btn"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-4 w-4"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>
</template>

<script>
  // @ts-nocheck
  // Icons
  const icons = {
    success: {
      bg: "bg-brand-lime/10",
      text: "text-brand-lime",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" /></svg>`,
    },
    error: {
      bg: "bg-red-500/10",
      text: "text-red-500",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" /></svg>`,
    },
    info: {
      bg: "bg-blue-500/10",
      text: "text-blue-500",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
    },
  };

  // Define showToast on global scope
  window.showToast = (message, type = "info", title = "") => {
    const container = document.getElementById("toast-container");
    const template = document.getElementById("toast-template");

    if (!container || !template) return;

    // Default Titles
    if (!title) {
      if (type === "success") title = "¡Éxito!";
      if (type === "error") title = "Error";
      if (type === "info") title = "Información";
    }

    // Clone
    const clone = template.content.cloneNode(true);
    const toast = clone.querySelector("div");

    if (!toast) return;

    // Setup Content
    const titleEl = toast.querySelector(".title");
    const msgEl = toast.querySelector(".message");
    if (titleEl) titleEl.innerText = title;
    if (msgEl) msgEl.innerText = message;

    // Setup Icon
    const iconConfig = icons[type] || icons.info;
    const iconContainer = toast.querySelector(".icon-container");
    if (iconContainer) {
      iconContainer.innerHTML = iconConfig.svg;
      iconContainer.className = `w-5 h-5 rounded-full flex items-center justify-center shrink-0 ${iconConfig.bg} ${iconConfig.text}`;
    }

    // Append
    container.appendChild(toast);

    // Animate In
    requestAnimationFrame(() => {
      toast.classList.remove("translate-x-10", "opacity-0");
    });

    // Auto Remove
    const timeout = setTimeout(() => {
      removeToast(toast);
    }, 5000);

    // Manual Close
    const closeBtn = toast.querySelector(".close-btn");
    if (closeBtn) {
      closeBtn.addEventListener("click", () => {
        clearTimeout(timeout);
        removeToast(toast);
      });
    }
  };

  function removeToast(el) {
    el.classList.add("translate-x-10", "opacity-0");
    setTimeout(() => {
      el.remove();
    }, 300);
  }

  // Event Listener wrapper for easy dispatching from other components
  window.addEventListener("toast", (e) => {
    const customEvent = e;
    if (customEvent.detail) {
      const { message, type, title } = customEvent.detail;
      window.showToast(message, type, title);
    }
  });
</script>
